# namespace

ุฏุฑ ุงุฏุงูู Namespaceโ ูุง ุฏุฑ ูููฺฉุณ ู ุณูพุณ ุฏุณุชูุฑ unshare -n bash ุฑุง ฺฉุงููุงูุ ุฏูู ู ูู ุชูุถุญ ูโุฏูู:

๐ฏ Namespace ุฏุฑ ูููฺฉุณ ฺุณุชุ

Namespace ฺฉ ุงุฒ ุชฺฉูฺฉโูุง ููู ุฏุฑ Linux Kernel ุจุฑุง ุงุฌุงุฏ ้็ฆป (Isolation) ุจู ูพุฑุฏุงุฒูโูุงุณุช.
Namespace ุจุงุนุซ ูโุดูุฏ ฺฉ ูพุฑุฏุงุฒู ุฏูุง ุฎูุฏุด ุฑุง ุจุจูุฏุ ูุงููุฏ:

ุดุจฺฉู ุฎูุฏุด

PID ุฎูุฏุด

Mount ูุง ู filesystem ุฎูุฏุด

ฺฉุงุฑุจุฑูุง ุฎูุฏุด

hostname ุฎูุฏุด

IPC ูุฎุตูุต ุฎูุฏ

cgroup ูุฎุตูุต ุฎูุฏ

ุงู ุฏููุงู ุชฺฉููููฺ ุงุตู ูพุดุช Docker ุLXC ุPodman ุงุณุช.

๐ฅ ุงููุงุน Namespace ุฏุฑ ูููฺฉุณ


| **Namespace** | **ูพุฑฺู (Flag)**      | **ฺฉุงุฑฺฉุฑุฏ**                                |
|---------------|-----------------------|---------------------------------------------|
| Mount         | `CLONE_NEWNS`         | ุฌุฏุงุณุงุฒ mount points                        |
| UTS           | `CLONE_NEWUTS`        | ุฌุฏุงุณุงุฒ hostname ู domainname               |
| IPC           | `CLONE_NEWIPC`        | ุฌุฏุงุณุงุฒ IPC (ูุงููุฏ message queue)          |
| PID           | `CLONE_NEWPID`        | ุฌุฏุง ฺฉุฑุฏู ุฌุฏูู PID                          |
| Network       | `CLONE_NEWNET`        | ุฌุฏุง ฺฉุฑุฏู Namespace ุดุจฺฉู                    |
| User          | `CLONE_NEWUSER`       | ุฌุฏุงุณุงุฒ ฺฉุงุฑุจุฑุงู ู ฺฏุฑููโูุง                  |
| Cgroup        | `CLONE_NEWCGROUP`     | ุฌุฏุงุณุงุฒ cgroup ูุง                           |
| Time          | `CLONE_NEWTIME`       | ุฌุฏุงุณุงุฒ ุฒูุงู ุณุณุชู                          |

๐ ุงุจุฒุงุฑูุง ฺฉู Namespace ุงุฌุงุฏ ูโฺฉููุฏ

unshare

nsenter

ip netns

ุงุจุฒุงุฑูุง container ูุซู Dockerุ Podmanุ LXC

๐ฅ ุฏุณุชูุฑ unshare ฺุณุชุ

unshare ุจู ุดูุง ุงุฌุงุฒู ูโุฏูุฏ ูพุฑุฏุงุฒูโุง ุฑุง ุจุฏูู ุจู ุงุฑุซ ุจุฑุฏู ฺฉ namespace ุงุฒ parent ุงุฌุฑุง ฺฉูุฏ.
ุนู ฺฉ child process ุจุง namespace ุฌุฏุฏ.

๐งจ unshare -n bash ฺู ูโฺฉูุฏุ (ุชูุถุญ ฺฉุงูู)

ูพุฑฺู -n ุนู:
```
-n  ุง --net
```

ุงู ุจุงุนุซ ุงุฌุงุฏ ฺฉ Network Namespace ุฌุฏุฏ ูโุดูุฏ.

ููุช ูโุฒูู:
```
unshare -n bash
```

ุนู:

ฺฉ Network Namespace ุฌุฏุฏ ุจุณุงุฒ ู ุฏุงุฎู ุขู ฺฉ Bash ุงุฌุฑุง ฺฉู.

ุฏุฑ ุงู ุญุงูุช:

โ ฺฉุงุฑุช ุดุจฺฉูโูุง ุฑุง ููโุจู

ุงฺฏุฑ ุฏุงุฎู bash ุฌุฏุฏ ุจุฒูุฏ:
```
ip a
```

ุฎูุงูุฏ ุฏุฏ:

loopback (lo) down ุงุณุช

ูฺ interface ุฏฺฏุฑ ูุฌูุฏ ูุฏุงุฑุฏ

โ ุดุจฺฉู ุฌุฏุง ูโุดูุฏ

ุฏุฑ ุงู bash ุฌุฏุฏ:

ุงูุชุฑูุช ูุฏุงุฑุฏ

ูพูฺฏ ููโุฒูุฏ

ูฺ ฺฉุงูฺฉุดู TCP ุฌุงุฑ ุฑุง ููโุจูุฏ

ูฺ iptables ูุจู ูุงุจู ุฏุฏู ูุณุช

route table ุฎุงู ุงุณุช

โจ ูุซุงู ุชุณุช:
ุงุฌุฑุง ูุญุท ุฌุฏุง:
```
unshare -n bash
```
ุชุณุช ุดุจฺฉู:
```
ping 8.8.8.8
```

ุฎุฑูุฌ:

connect: Network is unreachable

๐ง ูุนุงู ฺฉุฑุฏู loopback ุฏุฑ ุงู namespace

ุฏุงุฎู ููุงู bash:
```
ip link set lo up
```
๐งฉ ุงฺฏุฑ ุจุฎูุงูุฏ ฺฉ veth pair ุจุณุงุฒุฏ:

ุฏุฑ namespace ุงุตู:
```
ip link add veth0 type veth peer name veth1
ip link set veth1 netns <PID-UNSHARE>
```

ุฏุฑูู namespace ุฌุฏุฏ:
```
ip link set veth1 up
ip addr add 10.10.0.2/24 dev veth1
```
๐ ฺฉุงุฑุจุฑุฏูุง ููู unshare -n
1๏ธโฃ ุชุณุช ุงููุช (ูุงูุชูุฑ ุงูุฌฺฉุดู ุดุจฺฉู)

ฺฉ ุจุฑูุงูู ุฏุงุฎู namespace ุงุฌุฑุง ูโฺฉูุฏ ู ุชุฑุงูฺฉุด ุฑุง ุฌุฏุงฺฏุงูู ุจุฑุฑุณ ูโฺฉูุฏ.

2๏ธโฃ ูุงูุน ุฎุฑูุฌ ุดุจฺฉู ุจุฑุง ฺฉ ุจุฑูุงูู

ุจุฏูู ูุงุฑูุงู ูโุชูุงูุฏ ุจุฑูุงูู ุฑุง ุจุฏูู ุงูุชุฑูุช ุงุฌุฑุง ฺฉูุฏ:
```
unshare -n curl http://example.com
```

ูุชุฌู: ฺฉุงุฑ ููโฺฉูุฏ.

3๏ธโฃ ุชุณุช ุงุจุฒุงุฑูุง ูุซู iptables / nftables

ุจุฏูู ุฎุฑุงุจ ฺฉุฑุฏู ุณุณุชู ุงุตู.

4๏ธโฃ ุณุงุฎุช mini-container

unshare ูพุงู ุณุงุฎุช container ุงุณุช.

๐ฅ ุชูุงูุช unshare ุจุง ip netns
ุฏุณุชูุฑ	ุชูุถุญ
unshare -n	ฺฉ network namespace ุฌุฏุฏ ุจุฑุง ููุงู ูพุฑุฏุงุฒู ูโุณุงุฒุฏ
ip netns add X	ฺฉ namespace ุจุง ูุงู ูุดุฎุต ูโุณุงุฒุฏ ฺฉู ูโุชูุงูุฏ process ูุง ูุฎุชูู ุจู ุขู attach ฺฉูุฏ
๐ ููููู ฺฉุงูู:
```
unshare --net --uts --ipc --pid --mount --fork --mount-proc bash
```

ุงู ุชูุฑุจุงู ฺฉ container ูุงุชโูุฒู ุงุณุช.

๐ ุฎูุงุตู ุจุฑุง ุฏุฑฺฉ ุณุฑุน:

Namespace = ุฌูุงู ุฌุฏุง ุจุฑุง process

unshare = ุณุงุฎุช namespace ุฌุฏุฏ

unshare -n bash = ฺฉ bash ุจุง ุดุจฺฉู ุฌุฏุง

ุฏุงุฎู ุขู bash:

ุงูุชุฑูุช ูุฏุงุฑุฏ

ฺฉุงุฑุช ุดุจฺฉูโูุง ุฎุงู

route ู iptables ุฌุฏุงฺฏุงูู
